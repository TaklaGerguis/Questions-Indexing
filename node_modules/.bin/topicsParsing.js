const fs = require('fs')
const csv = require('csv-parser')
const db = require("../models");
const Topic = db.topics;


function addTopic(name, parent) {

    if (name === "" || parent === "") {
        return;
    }

    try {
        var parentNode = Topic.find({name: 'root'});
        console.log(parentNode.name);

        var oldRight = parentNode.right;
        db.topics.create({name: name, parent: parent, left: oldRight, right: oldRight + 1});
        db.topics.update({right: {$gte: oldRight}}, {$inc: {right: 2}});
    } catch {

    }
}


    fs.createReadStream('topics.csv')
        .pipe(csv())
        .on('data', function (row) {

            //console.log(row.level1);
            addTopic(row.level1, 'root');
            addTopic(row.level2, row.level1);
            addTopic(row.level3, row.level2);

        })

db.topics.find({name: 'root'}, function(err, result) {
    if (err) throw err;
    console.log(result);
})

var parentNode = Topic.findOne({name: 'root'}) .exec(function (err, topic){
    // User result only available inside of this function!
    console.log(topic) // => yields your user results
})
